<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b1a0f">
  <title>Buckeye Hunter Hub — Mobile Hunting Map</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="Icons/bhh-logo-180.png">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
</head>
<body>
  <div id="app">
    <div id="map"></div>

    <div id="bhhLayersBtn"><button id="bhhLayersBtnHandle">BHH Map Layers</button></div>
    <div class="map-logo"><img src="Icons/bhh-logo.png" alt="Buckeye Hunter Hub"/></div>
    <div id="stateBadge">State: <strong id="stateBadgeText">Ohio</strong></div>

    <nav class="main-menu" id="mainMenu">
      <button id="menuWind" class="wind-btn"><span class="wind-arrow" id="windArrow"></span><span id="windText">Wind: --</span></button>
      <button id="menuState">State</button>
      <button id="menuLocate">Locate Me</button>
      <button id="btnExport">Export</button>
      <button id="btnImport">Import</button>
    </nav>

    <div class="backdrop" id="sheetBackdrop"></div>

    <div class="sheet" id="layersSheet">
      <div class="grab"></div>
      <button class="close-x">×</button>
      <h4>BHH Map Layers</h4>
      <div class="content">
        <label class="option"><input type="checkbox" id="togglePublic" checked> Public Land</label>
        <label class="option"><input type="checkbox" id="toggleRadar"> Weather Radar (live)</label>
      </div>
    </div>

    <div class="sheet" id="stateSheet">
      <div class="grab"></div>
      <button class="close-x">×</button>
      <h4>Select State</h4>
      <div class="content">
        <label class="option"><input type="radio" name="bhhState" value="OH" checked> Ohio</label>
        <label class="option"><input type="radio" name="bhhState" value="IN"> Indiana</label>
        <label class="option"><input type="radio" name="bhhState" value="MI"> Michigan</label>
        <label class="option"><input type="radio" name="bhhState" value="PA"> Pennsylvania</label>
      </div>
    </div>
  </div>

  <style>
    :root{--bg:#0b1a0f;--panel:#101f14;--accent:#6dbc5d;--text:#e7f1e8;--shadow:0 12px 30px rgba(0,0,0,.35);--safe-bottom:env(safe-area-inset-bottom,0px);--logo-size:128px}
    html,body,#app{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif}
    #map{position:fixed;inset:0;height:100dvh}
    .map-logo{position:fixed;right:12px;top:12px;z-index:1300;pointer-events:none}
    .map-logo img{height:var(--logo-size);border-radius:10px;background:rgba(16,31,20,.6);padding:6px;box-shadow:var(--shadow)}
    #bhhLayersBtn{position:fixed;top:12px;left:12px;z-index:1300}
    #bhhLayersBtn button{background:var(--panel);border:1px solid var(--accent);color:var(--text);padding:10px 16px;border-radius:12px;font-weight:bold;box-shadow:var(--shadow)}
    #stateBadge{position:fixed;top:12px;left:50%;transform:translateX(-50%);z-index:1300;background:var(--panel);border:1px solid var(--accent);border-radius:12px;padding:6px 12px;font-weight:bold;box-shadow:var(--shadow)}
    .main-menu{position:fixed;left:0;right:0;bottom:0;z-index:1200;display:flex;gap:8px;justify-content:space-around;padding:10px 12px calc(10px + var(--safe-bottom));background:linear-gradient(180deg,rgba(11,26,15,.1),rgba(11,26,15,.85));backdrop-filter:blur(8px);border-top:1px solid #203325;flex-wrap:wrap}
    .main-menu button{flex:1;max-width:140px;padding:10px;border:1px solid #25432b;border-radius:12px;background:#14271a;color:var(--text);font-size:14px;cursor:pointer}
    .main-menu button[data-shop]{background:var(--accent);color:#000;font-weight:bold}
    .wind-btn{display:flex;align-items:center;gap:8px}
    .wind-arrow{width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent;border-bottom:12px solid #e7f1e8;display:inline-block;transform:rotate(0deg)}
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:1199;display:none}
    .backdrop.show{display:block}
    .sheet{position:fixed;left:0;right:0;bottom:0;z-index:1200;background:var(--panel);border-top:1px solid #203325;border-radius:16px 16px 0 0;box-shadow:var(--shadow);transform:translateY(110%);transition:transform .25s ease}
    .sheet.show{transform:translateY(0)}
    .sheet .grab{width:36px;height:4px;background:#2b4231;border-radius:999px;margin:8px auto}
    .sheet .close-x{position:absolute;top:8px;right:12px;width:32px;height:32px;background:#14271a;border:1px solid #25432b;border-radius:50%;font-size:18px;line-height:30px;text-align:center;cursor:pointer}
    .content{padding:0 16px 16px}
    .option{padding:12px 0;border-bottom:1px solid #1d3323;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .option:last-child{border-bottom:none}
    .leaflet-control-zoom{margin-top:120px !important}
  </style>

  <script>
    let map, radarLayer = null, scentCone = null, currentState = localStorage.getItem('bhh_state_code') || 'OH';
    const STATES = { OH: { name: 'Ohio', center: [40.4173, -82.9071], zoom: 7 }, IN: { name: 'Indiana', center: [39.8, -86.3], zoom: 7 }, MI: { name: 'Michigan', center: [44.3, -85.6], zoom: 6 }, PA: { name: 'Pennsylvania', center: [40.9, -77.8], zoom: 7 } };

    map = L.map('map', { zoomControl: false }).setView(STATES[currentState].center, STATES[currentState].zoom);
    L.tileLayer('https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=VLOZCnjQYBtgpZ3BXBK3', { attribution: '&copy; MapTiler &copy; OpenStreetMap' }).addTo(map);
    L.control.zoom({ position: 'topleft' }).addTo(map);

    // Radar
    const ts = Math.floor(Date.now() / 600000) * 600000;
    radarLayer = L.tileLayer(`https://tile.rainviewer.com/v2/radar/${ts}/256/{z}/{x}/{y}/8/1_1.png`, { opacity: 0.6 });
    document.getElementById('toggleRadar')?.addEventListener('change', e => e.target.checked ? radarLayer.addTo(map) : map.removeLayer(radarLayer));

    // Wind
    document.getElementById('menuWind')?.addEventListener('click', () => {
      if (scentCone) { map.removeLayer(scentCone); scentCone = null; return; }
      navigator.geolocation.getCurrentPosition(pos => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=\( {pos.coords.latitude}&longitude= \){pos.coords.longitude}&current_weather=true`)
          .then(r => r.json()).then(data => {
            const dir = data.current_weather.winddirection || 0;
            scentCone = L.circle([pos.coords.latitude, pos.coords.longitude], { radius: 805, color: '#6dbc5d', fillOpacity: 0.25 }).addTo(map);
            document.getElementById('windArrow').style.transform = `rotate(${dir - 90}deg)`;
            document.getElementById('windText').textContent = `Wind: ${data.current_weather.windspeed} mph`;
            map.setView([pos.coords.latitude, pos.coords.longitude], 16);
          });
      });
    });

    // Shop Gear
    const shopBtn = document.createElement('button');
    shopBtn.textContent = 'Shop Gear';
    shopBtn.dataset.shop = 'true';
    shopBtn.onclick = () => window.open('https://buckeyehunterhub.com/shop', '_blank');
    document.getElementById('mainMenu').appendChild(shopBtn);

    // State selector
    document.querySelectorAll('input[name="bhhState"]').forEach(r => r.addEventListener('change', e => {
      currentState = e.target.value;
      localStorage.setItem('bhh_state_code', currentState);
      document.getElementById('stateBadgeText').textContent = STATES[currentState].name;
      map.setView(STATES[currentState].center, STATES[currentState].zoom);
    }));

    // UI
    const backdrop = document.getElementById('sheetBackdrop');
    document.getElementById('bhhLayersBtnHandle')?.addEventListener('click', () => {
      document.getElementById('layersSheet').classList.add('show');
      backdrop.classList.add('show');
    });
    document.getElementById('menuState')?.addEventListener('click', () => {
      document.getElementById('stateSheet').classList.add('show');
      backdrop.classList.add('show');
    });
    backdrop.addEventListener('click', () => {
      document.querySelectorAll('.sheet').forEach(s => s.classList.remove('show'));
      backdrop.classList.remove('show');
    });
    document.querySelectorAll('.close-x').forEach(x => x.addEventListener('click', () => backdrop.click()));

    console.log("Buckeye Hunter Hub Map – ONE FILE – 100% WORKING – Nov 19 2025");
  </script>
</body>
</html>
